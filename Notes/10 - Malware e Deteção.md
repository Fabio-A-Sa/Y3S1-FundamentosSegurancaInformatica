# 10 - Malware e Deteção

O malware pode existir e propagar-se de muitas formas:
- exploração de pacotes de segurança de sistemas, que muitas vezes são ignorados mas que revelam detalhes de falta de segurança;
- `malvertising`, onde o malware é injectado no browser através de anúncios provenientes de servidores infectados;
- roubo de credenciais por parte de aplicações não fidedignas;
- deturpar o equipamento de fabrico;
- deturpar o software no fabrico do mesmo;

## Botnets

Rede de computadores com um sistema de controlo e comando comum que é capaz de enviar comandos pela rede. Existem dois tipos de arquitetura, ou **centralizada** (com servidores centrais para maior robustez do serviço) ou **peer-to-peer** por hierarquia. Existem também dois tipos de fluxo: **push** (o servidor envia comandos aos bots) ou **pull** (o bot pergunta ao servidor se há alguma tarefa).

### Deteção de botnets

- Detetar o malware na máquina comprometida;
- Detetar o tráfego pela rede;
- Expôr máquinas (*honeypots*) para serem comprometidas e monitorizadas;

### Combate de botnets

- Limpar máquinas comprometidas ou isolacontrolar computadores da internet. das na rede;
- Isolar e desligar o C2 (sistema de comando de controlo);
- Tomar o controlo da C2 e usá-la para desativar o botnet;

## Técnicas de Deteção

Nos sistemas de deteção existem sempre falsos positivos e falsos negativos. O desafio é sempre equilibrar estes dois parâmetros de acordo com o sistema em implementar. O alerta pode ser dado por diversos fatores:

- **Signature-based**, reconhecimento de assinaturas e padrões de ataques já conhecidos;
- **Anomalias**, como acesso à rede anómalo, acesso a ficheiros sensíveis, deteta uma grande gama de ataques mas é pouco preciso de eventos raros;
- **Integridade/espeficicação**, com manutenção de registos para detectar alterações de ficheiros críticos

- `IDS Intrusion Detection System`, deteção ocorre depois do ataque ter sido concretizado
- `IPS Intrusion Prevention System`, intervenção rápida para evitar o ataque

### HIDS - IDS no Host

É muito mais preciso na sua análise pois tem acesso direto à atividade maliciosa. Protegem os sistemas dos malwares que não são transportados na rede e permite observar os dados que são cifrados durante o transporte na rede. Configura-se de forma singular para cada ponta, algo impossível em sistemas MIDS. 

### NIDS - IDS na Network

Permite proteger muitos outros sistemas, é mais simples de gerir e instalar e não ocupa espaço nesses sistemas. É de mais difícil acesso para os atacantes.

### Pen-Testing

Além da análise de logs (que é um sistema barato), pode ser usado um ataque programado ao sistema para ver como reage. É muitas vezes esta a técnica utilizada por especialistas e *ethical hackers*.

### Antivirus

Como os virus não são totalmente invisíveis e o seu código está armazenado algures, muda qualquer coisa quando executa e essa mudança deve ser detectada pelo software do antivirus usado. Para vírus conhecidos pode haver extração da assinatura do seu padrão de operação. Atualmente os vírus são mutáveis e cifram-se para mudarem de forma, de código em cada utilização. 

- A nível de **HIDS** o antivirus utiliza sandboxing para poder em runtime avaliar os programas potencialmente perigosos;
- A nível de **NIDS** o antivirus analisa os protocolos, assinaturas, payloads, 

## TLS - Transport Layer Security

Inicialmente baseava-se em criptografia de chave pública, como RSA. Atualmente é feita através do DH (*Diffie-Hellman*) Autenticado, por isso é necessário PKI para estabelecer a ligação com o servidor e um hanshake inicial com certificados. Os certificados podem vir  assinados para proteger o nome do domínimo que viaja pela rede. 